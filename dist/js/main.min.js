function stripscript(e){for(var t=/[`~!@#\$%\^\&\*\(\)_\+<>\?:"\{\},\￥\\\/;'\[\]]/im,a="",n=0;n<e.length;n++)a+=e.substr(n,1).replace(t,"");return a}var arr=[{img:"https://img.alicdn.com/bao/uploaded/i2/2096579128/TB2.cqadp5N.eBjSZFvXXbvMFXa_!!2096579128.jpg_80x80.jpg",title:"冬季男士外套青年短款韩版修身潮男装加厚学生棉衣冬天棉袄子衣服",price:"￥5999.88",count:"1"},{img:"https://img.alicdn.com/bao/uploaded/i3/2096579128/TB21rp9dCmK.eBjSZPfXXce2pXa_!!2096579128.jpg_80x80.jpg",title:"冬季男士外套青年短款韩版修身潮男装加厚学生棉衣冬天棉袄子衣服",price:"￥5999.88",count:"1"},{img:"https://img.alicdn.com/bao/uploaded/i2/2096579128/TB2F3KVbMhJc1FjSZFDXXbvnFXa_!!2096579128.jpg_80x80.jpg",title:"冬季男士外套青年短款韩版修身潮男装加厚学生棉衣冬天棉袄子衣服",price:"￥5999.88",count:"1"}];!function(){function e(){for(var e=0,t=0,a="",n=0;n<p.length;n++)if(p[n].getElementsByTagName("input")[0].checked){var s=stripscript(p[n].cells[4].innerHTML);e+=parseInt(p[n].getElementsByTagName("input")[1].value),t+=parseFloat(s),a+='<li><img src="'+p[n].getElementsByTagName("img")[0].src+'" /><a index="'+n+'">取消选择</a></li>'}0==e&&(d.style.display="none"),l.innerHTML=e,m.innerHTML="合计（不含运费）：<span>￥</span><em>"+t.toFixed(2)+"</em>",o.innerHTML=a}function t(e){var t=e.cells,a=e.getElementsByTagName("input")[1],n=stripscript(t[2].innerHTML),s=parseFloat(n),c=parseInt(a.value),r=parseFloat(s*c).toFixed(2);t[4].innerHTML="￥"+r}function a(e,t,a,n){var s=document.createElement("tr"),c=stripscript(a);return s.innerHTML='<td><input class="check-one" type="checkbox" /></td>\t\t\t<td class="item-box">\t\t\t\t<img src="'+e+'" />\t\t\t\t<span class="item-name">\t\t\t\t\t<a href="javascript:;">'+t+'</a>\t\t\t\t</span>\t\t\t</td>\t\t\t<td class="price">'+a+'</td>\t\t\t<td class="num">\t\t\t\t<div class="conut-box">\t\t\t\t\t<span class="reduce"></span><input class="count" type="text" value="'+n+'" maxlength="3" /><span class="add">+</span>\t\t\t\t</div>\t\t\t</td>\t\t\t<td class="item-total">￥'+parseFloat(c)*parseInt(n)+'</td>\t\t\t<td><a class="del" href="javasript:;">删除</a></td>',s}function n(){h.innerHTML="";for(var e=0;e<arr.length;e++){var t=a(arr[e].img,arr[e].title,arr[e].price,arr[e].count);console.log(t),h.appendChild(t)}}document.getElementsByClassName||(document.getElementsByClassName=function(e){for(var t=[],a=document.getElementsByTagName("*"),n=0,s=a.length;n<s;n++)(a[n].className.indexOf(e+" ")>=0||a[n].className.indexOf(" "+e+" ")>=0||a[n].className.indexOf(" "+e)>=0)&&t.push(a[n]);return t});for(var s=document.getElementById("box"),c=document.getElementsByClassName("check-all"),r=(document.getElementsByClassName("item-total"),document.getElementById("selected")),l=r.getElementsByTagName("em")[0],i=r.getElementsByTagName("span")[1],o=document.getElementById("item-list").getElementsByTagName("ul")[0],m=document.getElementById("total"),d=document.getElementById("popup"),p=s.children[1].rows,g=document.getElementById("delSel"),u=document.getElementById("pay"),h=s.getElementsByTagName("tbody")[0],N=document.getElementsByClassName("check-one"),v=0;v<c.length;v++)c[v].onclick=function(){for(var t=0;t<N.length;t++)N[t].checked=this.checked,this.checked?N[t].parentNode.parentNode.className="on":N[t].parentNode.parentNode.className="";for(var a=0;a<c.length;a++)c[a].checked=this.checked;e(),0!=l.innerHTML?u.className="pay active":u.className="pay"};r.onclick=function(){"none"==d.style.display?0!=l.innerHTML&&(d.style.display="block",i.className="arrow down"):(d.style.display="none",i.className="arrow")},o.onclick=function(e){var t=e||event,a=t.srcElement||t.target;if("A"==a.tagName){var n=a.getAttribute("index"),s=p[n].getElementsByTagName("input")[0];s.checked=!1,s.onclick()}},n();for(var v=0;v<p.length;v++)p[v].onclick=function(a){var n=a||event,s=n.srcElement||n.target,c=s.className,r=this.getElementsByTagName("input")[1],l=parseInt(r.value),i=this.getElementsByClassName("reduce")[0];switch(c){case"add":r.value=l+1,i.innerHTML="-",t(this);break;case"reduce":r.value>1&&(r.value=l-1),r.value<=1&&(i.innerHTML=""),t(this);break;case"del":var o=window.confirm("确认删除吗？");o&&this.parentNode.removeChild(this)}e()},p[v].getElementsByTagName("input")[1].onkeyup=function(){var a=parseInt(this.value),n=this.parentNode.parentNode.parentNode,s=n.getElementsByClassName("reduce")[0];(isNaN(a)||a<1)&&(a=1),this.value=a,a<=1?s.innerHTML="":s.innerHTML="-",t(this.parentNode.parentNode.parentNode),e()};for(var v=0;v<N.length;v++)N[v].onclick=function(){for(var t=0,a=0;a<N.length;a++)N[a].checked&&t++;if(t==N.length)for(var n=0;n<c.length;n++)c[n].checked=!0;else for(var n=0;n<c.length;n++)c[n].checked=!1;e(),0!=l.innerHTML?(u.className="pay active",u.onclick=function(){alert("没钱你还点那么多？")}):u.className="pay",1==this.checked?this.parentNode.parentNode.className="on":this.parentNode.parentNode.className=""};g.onclick=function(){if("0"!=l.innerHTML){var e=window.confirm("确认删除吗？");if(e){for(var t=0;t<p.length;t++){var a=p[t].getElementsByTagName("input")[0];a.checked&&(p[t].parentNode.removeChild(p[t]),t--)}l.innerHTML=0,m.innerHTML="合计（不含运费）：<span>￥</span><em>0</em>"}}}}();